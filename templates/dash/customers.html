{% extends "dash/base.html" %}
{% block content %}

<div class="customer-container">
    <div class="header">
        <h2>Customers</h2>
        <button class="btn" id="openModalBtn"><i class="fas fa-user-plus"></i> Add Customer</button>
    </div>

    <!-- Customers Table -->
    <table class="customer-table">
        <thead>
            <tr>
                <th>Image</th>
                <th>Username</th>
                <th>Full Name</th>
                <th>ID Card</th>
                <th>Email</th>
                <th>Account</th>
                <th>Balance</th>
            </tr>
        </thead>
        <tbody>
            {% for c in customers %}
            <tr>
                <td>
                    {% if c.image %}
                        <img src="{{ c.image.url }}" class="avatar">
                    {% else %}
                        <i class="fas fa-user-circle fa-2x"></i>
                    {% endif %}
                </td>
                <td>{{ c.username }}</td>
                <td>{{ c.full_name }}</td>
                <td>{{ c.id_card|default:"-" }}</td>
                <td>{{ c.user.email }}</td>
                <td>
                    {% with account=c.account_set.first %}
                        {% if account %}
                            {{ account.get_account_type_display }}
                        {% else %}
                            -
                        {% endif %}
                    {% endwith %}
                </td>
                <td>
                    {% with account=c.account_set.first %}
                        {% if account %}
                            {{ account.balance }} {{ account.currency }}
                        {% else %}
                            -
                        {% endif %}
                    {% endwith %}
                </td>
            </tr>
            {% empty %}
            <tr><td colspan="7" class="text-center">No customers found</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Modal -->
<div id="customerModal" class="modal">
    <div class="modal-content">
        <span class="close" id="closeModalBtn">&times;</span>
        <h3>Create Customer & Account</h3>
        <form method="POST" enctype="multipart/form-data" class="customer-form">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit" class="btn btn-submit">Create</button>
        </form>
    </div>
</div>

<style>
/* Container */
.customer-container {
    background: #fff;
    padding: 2rem;
    border-radius: 10px;
    box-shadow: 0 2px 12px rgba(0,0,0,0.1);
}
.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.btn {
    background: #007bff;
    color: white;
    border: none;
    padding: 0.6rem 1.2rem;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.9rem;
}
.btn:hover { background: #0056b3; }

/* Table */
.customer-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 1.5rem;
}
.customer-table th, .customer-table td {
    padding: 0.8rem;
    border-bottom: 1px solid #ddd;
    text-align: left;
}
.customer-table th {
    background: #f4f6f8;
}
.avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    object-fit: cover;
}

/* Modal */
.modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center; }
.modal-content { background: white; padding: 2rem; border-radius: 12px; width: 450px; max-width: 90%; position: relative; }
.close { position: absolute; top: 10px; right: 15px; font-size: 1.5rem; cursor: pointer; }

/* Form Styling */
.customer-form p {
    margin-bottom: 1rem;
}
.customer-form label {
    display: block;
    margin-bottom: 0.4rem;
    font-weight: bold;
    color: #333;
}
.customer-form input,
.customer-form select,
.customer-form textarea {
    width: 100%;
    padding: 0.6rem;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 0.9rem;
    transition: border 0.2s, box-shadow 0.2s;
}
.customer-form input:focus,
.customer-form select:focus,
.customer-form textarea:focus {
    border-color: #007bff;
    box-shadow: 0 0 4px rgba(0,123,255,0.3);
    outline: none;
}
.btn-submit {
    width: 100%;
    margin-top: 1rem;
    background: #28a745;
}
.btn-submit:hover {
    background: #218838;
}
</style>

<script>
const modal = document.getElementById("customerModal");
const openBtn = document.getElementById("openModalBtn");
const closeBtn = document.getElementById("closeModalBtn");

openBtn.onclick = () => { modal.style.display = "flex"; }
closeBtn.onclick = () => { modal.style.display = "none"; }
window.onclick = (e) => { if (e.target == modal) modal.style.display = "none"; }
</script>

{% endblock %}

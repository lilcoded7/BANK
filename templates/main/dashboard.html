{% extends 'main/base.html' %}

{% block content %}


        <!-- Main Content -->
        <div class="main-content">
            <div class="header">
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <button class="mobile-menu-toggle" id="menuToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="page-title">Dashboard</div>
                </div>
                <div class="user-profile">
                    <div class="user-avatar">
                        {% if user.is_biometric_enabled %}
                            <i class="fas fa-fingerprint"></i>
                        {% else %}
                            {{ user.first_name|first }}{{ user.last_name|first }}
                        {% endif %}
                    </div>
                    <div class="user-name">{{ user.first_name }} {{ user.last_name }}</div>
                </div>
            </div>

            <!-- Display messages -->
            {% if messages %}
                {% for message in messages %}
                    <div class="message message-{% if message.tags %}{{ message.tags }}{% endif %}">
                        <i class="fas 
                            {% if message.tags == 'success' %}fa-check-circle
                            {% elif message.tags == 'error' %}fa-exclamation-circle
                            {% else %}fa-info-circle{% endif %}"></i>
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}

            <!-- Account Overview -->
            <div class="dashboard-grid">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Total Balance</div>
                        <div class="card-icon">
                            <i class="fas fa-wallet"></i>
                        </div>
                    </div>
                    <div class="card-value">₵{{ total_balance|floatformat:2 }}</div>
                    <div class="card-change">
                        <i class="fas fa-arrow-up"></i>
                        <span>All accounts</span>
                    </div>
                    <div class="security-badge">
                        <i class="fas fa-link"></i>
                        <span>GhIPSS Interoperable</span>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Security Status</div>
                        <div class="card-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                    </div>
                    <div class="card-value">
                        {% if user.is_biometric_enabled %}
                            Verified <span class="status-indicator status-active"></span>
                        {% else %}
                            Standard <span class="status-indicator status-pending"></span>
                        {% endif %}
                    </div>
                    <div class="card-change">
                        <i class="fas fa-clock"></i>
                        <span>Last login: Just now</span>
                    </div>
                    <div class="security-badge">
                        <i class="fas fa-lock"></i>
                        <span>Zero-Trust Framework</span>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Active Accounts</div>
                        <div class="card-icon">
                            <i class="fas fa-credit-card"></i>
                        </div>
                    </div>
                    <div class="card-value">{{ accounts.count }}</div>
                    <div class="card-change">
                        <i class="fas fa-check-circle"></i>
                        <span>All accounts active</span>
                    </div>
                </div>
            </div>

            <!-- My Accounts -->
            <div class="section">
                <div class="section-header">
                    <div class="section-title">My Accounts</div>
                </div>
                <div class="feature-grid">
                {% for account in accounts %}
                <div class="feature-card">
                    <div class="feature-icon">
                        {% if account.account_type == 'SAVINGS' %}
                            <i class="fas fa-piggy-bank"></i>
                        {% elif account.account_type == 'CHECKING' %}
                            <i class="fas fa-money-bill-wave"></i>
                        {% else %}
                            <i class="fas fa-university"></i>
                        {% endif %}
                    </div>
                    <div class="feature-title">{{ account.get_account_type_display }}</div>
                    <div class="feature-desc">
                        {{ account.account_number }}<br>
                        ₵{{ account.balance|floatformat:2 }}
                    </div>
                </div>
                {% endfor %}
            </div>
            </div>

            <!-- Recent Transactions -->
            <div class="section">
                <div class="section-header">
                    <div class="section-title">Recent Transactions</div>
                    <a href="{% url 'transfer_funds' %}" class="section-link">View All</a>
                </div>
                <div class="card">
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Description</th>
                                <th style="text-align: right;">Amount</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for transaction in recent_transactions %}
                            <tr>
                                <td>{{ transaction.timestamp|date:"M d, Y" }}</td>
                                <td>
                                    {{ transaction.description|default:"No description" }}
                                    {% if transaction.transaction_type == 'MOBILE_MONEY' %}
                                        <i class="fas fa-mobile-alt" style="color: var(--primary); margin-left: 0.5rem;"></i>
                                    {% elif transaction.transaction_type == 'BILL_PAYMENT' %}
                                        <i class="fas fa-file-invoice" style="color: var(--primary); margin-left: 0.5rem;"></i>
                                    {% endif %}
                                </td>
                                <td style="text-align: right; {% if transaction.sender_account.customer == user %}color: var(--danger){% else %}color: var(--success){% endif %}">
                                    {% if transaction.sender_account.customer == user %}-{% else %}+{% endif %}
                                    ₵{{ transaction.amount|floatformat:2 }}
                                </td>
                                <td>
                                    <span class="status-indicator 
                                        {% if transaction.status == 'COMPLETED' %}status-active
                                        {% elif transaction.status == 'PENDING' %}status-pending
                                        {% else %}status-inactive{% endif %}">
                                    </span>
                                    {{ transaction.get_status_display }}
                                </td>
                            </tr>
                            {% empty %}
                            <tr>
                                <td colspan="4" style="text-align: center; padding: 1rem;">No recent transactions</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="section">
                <div class="section-header">
                    <div class="section-title">Quick Actions</div>
                </div>
                <div class="feature-grid">
                    <div class="feature-card" onclick="window.location.href='{% url 'transfer_funds' %}'">
                        <div class="feature-icon">
                            <i class="fas fa-exchange-alt"></i>
                        </div>
                        <div class="feature-title">Transfer Funds</div>
                        <div class="feature-desc">Send money to other accounts</div>
                    </div>
                    
                    <div class="feature-card" onclick="window.location.href='{% url 'mobile_money' %}'">
                        <div class="feature-icon">
                            <i class="fas fa-mobile-alt"></i>
                        </div>
                        <div class="feature-title">Mobile Money</div>
                        <div class="feature-desc">Send/receive mobile money</div>
                    </div>
                    
                    <div class="feature-card" onclick="window.location.href='{% url 'security_settings' %}'">
                        <div class="feature-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <div class="feature-title">Security Settings</div>
                        <div class="feature-desc">Manage your security preferences</div>
                    </div>
                    
                    <div class="feature-card" onclick="window.location.href='{% url 'bill_payment' %}'">
                        <div class="feature-icon">
                            <i class="fas fa-file-invoice"></i>
                        </div>
                        <div class="feature-title">Pay Bills</div>
                        <div class="feature-desc">Pay utilities and other bills</div>
                    </div>
                </div>
            </div>
        </div>
    
    <!-- AI Assistant Floating Button -->
    <div class="assistant" onclick="alert('AI Assistant coming soon!')">
        <i class="fas fa-robot"></i>
    </div>

    <script>
        // Mobile Menu Toggle
        const menuToggle = document.getElementById('menuToggle');
        const sidebar = document.getElementById('sidebar');
        
        menuToggle.addEventListener('click', function(e) {
            e.stopPropagation();
            sidebar.classList.toggle('active');
        });
        
        // Close sidebar when clicking outside on mobile
        document.addEventListener('click', function(e) {
            if (window.innerWidth <= 992 && !sidebar.contains(e.target)) {
                sidebar.classList.remove('active');
            }
        });

        // Prevent clicks inside sidebar from closing it
        sidebar.addEventListener('click', function(e) {
            e.stopPropagation();
        });
    </script>

{% endblock content %}